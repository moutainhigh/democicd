<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.uwallet.pay.main.dao.RefundFlowDAO">

  <resultMap id="refundFlowMap" type="com.uwallet.pay.main.model.entity.RefundFlow">
    <id property="id" jdbcType="BIGINT" column="id"/>
    <result property="flowId" jdbcType="BIGINT" column="flow_id"/>
    <result property="gatewayId" jdbcType="BIGINT" column="gateway_id"/>
    <result property="orgRecUserId" jdbcType="BIGINT" column="org_rec_user_id"/>
    <result property="refundAmount" jdbcType="DECIMAL" column="refund_amount"/>
    <result property="ordreNo" jdbcType="VARCHAR" column="ordre_no"/>
    <result property="omiPayRefundOrderNo" jdbcType="VARCHAR" column="omi_pay_refund_order_no"/>
    <result property="lpsRefundId" jdbcType="VARCHAR" column="lps_refund_id"/>
    <result property="requestId" jdbcType="VARCHAR" column="request_id"/>
    <result property="replyPwd" jdbcType="VARCHAR" column="reply_pwd"/>
    <result property="transType" jdbcType="TINYINT" column="trans_type"/>
    <result property="state" jdbcType="TINYINT" column="state"/>
    <result property="currency" jdbcType="VARCHAR" column="currency"/>
    <result property="batchId" jdbcType="BIGINT" column="batch_id"/>
    <result property="returnCode" jdbcType="VARCHAR" column="return_code"/>
    <result property="returnMessage" jdbcType="VARCHAR" column="return_message"/>
    <result property="customerIpaddress" jdbcType="VARCHAR" column="customer_ipaddress"/>
    <result property="crdstrgToken" jdbcType="VARCHAR" column="crdstrg_token"/>
    <result property="clearState" jdbcType="TINYINT" column="clear_state"/>
    <result property="clearTime" jdbcType="BIGINT" column="clear_time"/>
    <result property="notSettlementAmount" jdbcType="DECIMAL" column="not_settlement_amount"/>
    <result property="settlementState" jdbcType="TINYINT" column="settlement_state"/>
    <result property="settlementTime" jdbcType="BIGINT" column="settlement_time"/>
    <result property="reason" jdbcType="VARCHAR" column="reason"/>
    <result property="remark" jdbcType="VARCHAR" column="remark"/>
    <result property="createdBy" jdbcType="BIGINT" column="created_by"/>
    <result property="createdDate" jdbcType="BIGINT" column="created_date"/>
    <result property="modifiedBy" jdbcType="BIGINT" column="modified_by"/>
    <result property="modifiedDate" jdbcType="BIGINT" column="modified_date"/>
    <result property="status" jdbcType="TINYINT" column="status"/>
    <result property="ip" jdbcType="VARCHAR" column="ip"/>
    <result property="checkState" jdbcType="TINYINT" column="check_state"/>
    <result property="checkTime" jdbcType="BIGINT" column="check_time"/>
    <result property="makeUpFee" jdbcType="DECIMAL" column="make_up_fee"/>
    <result property="makeUpState" jdbcType="TINYINT" column="make_up_state"/>
    <result property="stripeRefundNo" jdbcType="VARCHAR" column="stripe_refund_no"/>
      <result property="orgThirdNo" jdbcType="VARCHAR" column="org_third_no"/>
  </resultMap>

  <resultMap id="refundFlowDTOMap" type="com.uwallet.pay.main.model.dto.RefundFlowDTO">
        <id property="id" jdbcType="BIGINT" column="id"/>
        <result property="flowId" jdbcType="BIGINT" column="flow_id"/>
        <result property="gatewayId" jdbcType="BIGINT" column="gateway_id"/>
        <result property="orgRecUserId" jdbcType="BIGINT" column="org_rec_user_id"/>
        <result property="refundAmount" jdbcType="DECIMAL" column="refund_amount"/>
        <result property="ordreNo" jdbcType="VARCHAR" column="ordre_no"/>
        <result property="omiPayRefundOrderNo" jdbcType="VARCHAR" column="omi_pay_refund_order_no"/>
        <result property="lpsRefundId" jdbcType="VARCHAR" column="lps_refund_id"/>
        <result property="requestId" jdbcType="VARCHAR" column="request_id"/>
        <result property="replyPwd" jdbcType="VARCHAR" column="reply_pwd"/>
        <result property="transType" jdbcType="TINYINT" column="trans_type"/>
        <result property="state" jdbcType="TINYINT" column="state"/>
        <result property="currency" jdbcType="VARCHAR" column="currency"/>
        <result property="batchId" jdbcType="BIGINT" column="batch_id"/>
        <result property="returnCode" jdbcType="VARCHAR" column="return_code"/>
        <result property="returnMessage" jdbcType="VARCHAR" column="return_message"/>
        <result property="customerIpaddress" jdbcType="VARCHAR" column="customer_ipaddress"/>
        <result property="crdstrgToken" jdbcType="VARCHAR" column="crdstrg_token"/>
        <result property="clearState" jdbcType="TINYINT" column="clear_state"/>
        <result property="clearTime" jdbcType="BIGINT" column="clear_time"/>
        <result property="notSettlementAmount" jdbcType="DECIMAL" column="not_settlement_amount"/>
        <result property="settlementState" jdbcType="TINYINT" column="settlement_state"/>
        <result property="settlementTime" jdbcType="BIGINT" column="settlement_time"/>
        <result property="reason" jdbcType="VARCHAR" column="reason"/>
        <result property="remark" jdbcType="VARCHAR" column="remark"/>
        <result property="createdBy" jdbcType="BIGINT" column="created_by"/>
        <result property="createdDate" jdbcType="BIGINT" column="created_date"/>
        <result property="modifiedBy" jdbcType="BIGINT" column="modified_by"/>
        <result property="modifiedDate" jdbcType="BIGINT" column="modified_date"/>
        <result property="status" jdbcType="TINYINT" column="status"/>
        <result property="ip" jdbcType="VARCHAR" column="ip"/>
        <result property="checkState" jdbcType="TINYINT" column="check_state"/>
        <result property="checkTime" jdbcType="BIGINT" column="check_time"/>
        <result property="makeUpFee" jdbcType="DECIMAL" column="make_up_fee"/>
        <result property="makeUpState" jdbcType="TINYINT" column="make_up_state"/>
      <result property="orgThirdNo" jdbcType="VARCHAR" column="org_third_no"/>
      <result property="stripeRefundNo" jdbcType="VARCHAR" column="stripe_refund_no"/>
  </resultMap>

    <insert id="insert" parameterType="com.uwallet.pay.main.model.entity.RefundFlow">
        INSERT INTO u_refund_flow (
        <if test="id != null">
            `id`
        </if>
        <if test="flowId != null">
            ,`flow_id`
        </if>
        <if test="refundNo != null">
            ,`refund_no`
        </if>
        <if test="orgRecUserId != null">
            ,`org_rec_user_id`
        </if>
        <if test="orgThirdNo != null">
            ,`org_third_no`
        </if>
        <if test="gatewayId != null">
            ,`gateway_id`
        </if>
        <if test="refundAmount != null">
            ,`refund_amount`
        </if>
        <if test="ordreNo != null">
            ,`ordre_no`
        </if>
        <if test="omiPayRefundOrderNo != null">
            ,`omi_pay_refund_order_no`
        </if>
        <if test="lpsRefundId != null">
            ,`lps_refund_id`
        </if>
        <if test="requestId != null">
            ,`request_id`
        </if>
        <if test="replyPwd != null">
            ,`reply_pwd`
        </if>
        <if test="transType != null">
            ,`trans_type`
        </if>
        <if test="state != null">
            ,`state`
        </if>
        <if test="currency != null">
            ,`currency`
        </if>
        <if test="returnCode != null">
            ,`return_code`
        </if>
        <if test="returnMessage != null">
            ,`return_message`
        </if>
        <if test="customerIpaddress != null">
            ,`customer_ipaddress`
        </if>
        <if test="crdstrgToken != null">
            ,`crdstrg_token`
        </if>
        <if test="settlementState != null">
            ,`settlement_state`
        </if>
        <if test="settlementTime != null">
            ,`settlement_time`
        </if>
        <if test="makeUpFee != null">
            ,`make_up_fee`
        </if>
        <if test="makeUpState != null">
            ,`make_up_state`
        </if>
        <if test="reason != null">
            ,`reason`
        </if>
        <if test="remark != null">
            ,`remark`
        </if>
        <if test="createdBy != null">
            ,`created_by`
        </if>
        <if test="createdDate != null">
            ,`created_date`
        </if>
        <if test="modifiedBy != null">
            ,`modified_by`
        </if>
        <if test="modifiedDate != null">
            ,`modified_date`
        </if>
        <if test="status != null">
            ,`status`
        </if>
        <if test="ip != null">
            ,`ip`
        </if>
        <if test="batchId != null">
            ,`batch_id`
        </if>
        <if test="clearState != null">
            ,`clear_state`
        </if>
        <if test="clearTime != null">
            ,`clear_time`
        </if>
        <if test="notSettlementAmount != null">
            ,`not_settlement_amount`
        </if>
        <if test="checkState != null">
            ,`check_state`
        </if>
        <if test="checkTime != null">
            ,`check_time`
        </if>
        <if test="stripeRefundNo != null">
            ,`stripe_refund_no`
        </if>
        ) VALUES (
        <if test="id != null">
            #{id}
        </if>
        <if test="flowId != null">
            ,#{flowId}
        </if>
        <if test="refundNo != null">
            ,#{refundNo}
        </if>
        <if test="orgRecUserId != null">
            ,#{orgRecUserId}
        </if>
        <if test="orgThirdNo != null">
            ,#{orgThirdNo}
        </if>
        <if test="gatewayId != null">
            ,#{gatewayId}
        </if>
        <if test="refundAmount != null">
            ,#{refundAmount}
        </if>
        <if test="ordreNo != null">
            ,#{ordreNo}
        </if>
        <if test="omiPayRefundOrderNo != null">
            ,#{omiPayRefundOrderNo}
        </if>
        <if test="lpsRefundId != null">
            ,#{lpsRefundId}
        </if>
        <if test="requestId != null">
            ,#{requestId}
        </if>
        <if test="replyPwd != null">
            ,#{replyPwd}
        </if>
        <if test="transType != null">
            ,#{transType}
        </if>
        <if test="state != null">
            ,#{state}
        </if>
        <if test="currency != null">
            ,#{currency}
        </if>
        <if test="returnCode != null">
            ,#{returnCode}
        </if>
        <if test="returnMessage != null">
            ,#{returnMessage}
        </if>
        <if test="customerIpaddress != null">
            ,#{customerIpaddress}
        </if>
        <if test="crdstrgToken != null">
            ,#{crdstrgToken}
        </if>
        <if test="settlementState != null">
            ,#{settlementState}
        </if>
        <if test="settlementTime != null">
            ,#{settlementTime}
        </if>
        <if test="makeUpFee != null">
            ,#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            ,#{makeUpState}
        </if>
        <if test="reason != null">
            ,#{reason}
        </if>
        <if test="remark != null">
            ,#{remark}
        </if>
        <if test="createdBy != null">
            ,#{createdBy}
        </if>
        <if test="createdDate != null">
            ,#{createdDate}
        </if>
        <if test="modifiedBy != null">
            ,#{modifiedBy}
        </if>
        <if test="modifiedDate != null">
            ,#{modifiedDate}
        </if>
        <if test="status != null">
            ,#{status}
        </if>
        <if test="ip != null">
            ,#{ip}
        </if>
        <if test="batchId != null">
            ,#{batchId}
        </if>
        <if test="clearState != null">
            ,#{clearState}
        </if>
        <if test="clearTime != null">
            ,#{clearTime}
        </if>
        <if test="notSettlementAmount != null">
            ,#{notSettlementAmount}
        </if>
        <if test="checkState != null">
            ,#{checkState}
        </if>
        <if test="checkTime != null">
            ,#{checkTime}
        </if>
        <if test="stripeRefundNo != null">
            ,#{stripeRefundNo}
        </if>
        )
    </insert>

    <insert id="insertList" parameterType="List">
        INSERT INTO u_refund_flow (
        `id`,
        `flow_id`,
        `refund_no`,
        `org_rec_user_id`,
        `org_third_no`,
        `gateway_id`,
        `refund_amount`,
        `ordre_no`,
        `omi_pay_refund_order_no`,
        `lps_refund_id`,
        `request_id`,
        `reply_pwd`,
        `trans_type`,
        `state`,
        `currency`,
        `return_code`,
        `return_message`,
        `customer_ipaddress`,
        `crdstrg_token`,
        `settlement_state`,
        `settlement_time`,
        `make_up_fee`,
        `make_up_state`,
        `reason`,
        `remark`,
        `created_by`,
        `created_date`,
        `modified_by`,
        `modified_date`,
        `status`,
        `ip`,
        `batch_id`,
        `clear_state`,
        `clear_time`,
        `not_settlement_amount`,
        `check_state`,
        `check_time`,
        `stripe_refund_no`
        ) VALUES
        <foreach collection="list" item="data" separator=",">
            (
            #{data.id},
            #{data.flowId},
            #{data.refundNo},
            #{data.orgRecUserId},
            #{data.orgThirdNo},
            #{data.gatewayId},
            #{data.refundAmount},
            #{data.ordreNo},
            #{data.omiPayRefundOrderNo},
            #{data.lpsRefundId},
            #{data.requestId},
            #{data.replyPwd},
            #{data.transType},
            #{data.state},
            #{data.currency},
            #{data.returnCode},
            #{data.returnMessage},
            #{data.customerIpaddress},
            #{data.crdstrgToken},
            #{data.settlementState},
            #{data.settlementTime},
            #{data.makeUpFee},
            #{data.makeUpState},
            #{data.reason},
            #{data.remark},
            #{data.createdBy},
            #{data.createdDate},
            #{data.modifiedBy},
            #{data.modifiedDate},
            #{data.status},
            #{data.ip},
            #{data.batchId},
            #{data.clearState},
            #{data.clearTime},
            #{data.notSettlementAmount},
            #{data.checkState},
            #{data.checkTime},
            #{data.stripeRefundNo}
            )
        </foreach>
    </insert>

    <update id="update" parameterType="com.uwallet.pay.main.model.entity.RefundFlow">
        UPDATE u_refund_flow
        <set>
            <if test="id != null">
                `id`=#{id},
            </if>
            <if test="flowId != null">
                `flow_id`=#{flowId},
            </if>
            <if test="refundNo != null">
                `refund_no`=#{refundNo},
            </if>
            <if test="orgRecUserId != null">
                `org_rec_user_id`=#{orgRecUserId},
            </if>
            <if test="orgThirdNo != null">
                `org_third_no`=#{orgThirdNo},
            </if>
            <if test="gatewayId != null">
                `gateway_id`=#{gatewayId},
            </if>
            <if test="refundAmount != null">
                `refund_amount`=#{refundAmount},
            </if>
            <if test="ordreNo != null">
                `ordre_no`=#{ordreNo},
            </if>
            <if test="omiPayRefundOrderNo != null">
                `omi_pay_refund_order_no`=#{omiPayRefundOrderNo},
            </if>
            <if test="lpsRefundId != null">
                `lps_refund_id`=#{lpsRefundId},
            </if>
            <if test="requestId != null">
                `request_id`=#{requestId},
            </if>
            <if test="replyPwd != null">
                `reply_pwd`=#{replyPwd},
            </if>
            <if test="transType != null">
                `trans_type`=#{transType},
            </if>
            <if test="state != null">
                `state`=#{state},
            </if>
            <if test="currency != null">
                `currency`=#{currency},
            </if>
            <if test="returnCode != null">
                `return_code`=#{returnCode},
            </if>
            <if test="returnMessage != null">
                `return_message`=#{returnMessage},
            </if>
            <if test="customerIpaddress != null">
                `customer_ipaddress`=#{customerIpaddress},
            </if>
            <if test="crdstrgToken != null">
                `crdstrg_token`=#{crdstrgToken},
            </if>
            <if test="settlementState != null">
                `settlement_state`=#{settlementState},
            </if>
            <if test="settlementTime != null">
                `settlement_time`=#{settlementTime},
            </if>
            <if test="makeUpFee != null">
                `make_up_fee`=#{makeUpFee},
            </if>
            <if test="makeUpState != null">
                `make_up_state`=#{makeUpState},
            </if>
            <if test="reason != null">
                `reason`=#{reason},
            </if>
            <if test="remark != null">
                `remark`=#{remark},
            </if>
            <if test="createdBy != null">
                `created_by`=#{createdBy},
            </if>
            <if test="createdDate != null">
                `created_date`=#{createdDate},
            </if>
            <if test="modifiedBy != null">
                `modified_by`=#{modifiedBy},
            </if>
            <if test="modifiedDate != null">
                `modified_date`=#{modifiedDate},
            </if>
            <if test="status != null">
                `status`=#{status},
            </if>
            <if test="ip != null">
                `ip`=#{ip},
            </if>
            <if test="batchId != null">
                `batch_id`=#{batchId},
            </if>
            <if test="clearState != null">
                `clear_state`=#{clearState},
            </if>
            <if test="clearTime != null">
                `clear_time`=#{clearTime},
            </if>
            <if test="notSettlementAmount != null">
                `not_settlement_amount`=#{notSettlementAmount},
            </if>
            <if test="checkState != null">
                `check_state`=#{checkState},
            </if>
            <if test="checkTime != null">
                `check_time`=#{checkTime},
            </if>
            <if test="stripeRefundNo != null">
                `stripe_refund_no`=#{stripeRefundNo},
            </if>
        </set>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <choose>
                <when test="status != null ">AND status = #{status.value}</when>
                <otherwise><![CDATA[AND status > 0]]></otherwise>
            </choose>
            AND id = #{id}
        </trim>
    </update>

  <update id="delete" parameterType="Map">
      UPDATE u_refund_flow
      SET `status`=0,`modified_by`=#{modifiedBy},`modified_date`=#{modifiedDate}
      WHERE id = #{id}
  </update>

  <delete id="pdelete" parameterType="Map">
      DELETE FROM u_refund_flow
      WHERE id = #{id}
  </delete>

  <select id="count" parameterType="Map" resultType="Integer">
    <![CDATA[
            SELECT COUNT(DISTINCT id) FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
          <choose>
            <when test="status != null">And status = #{status}</when>
            <otherwise><![CDATA[And status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
    </trim>
  </select>

  <select id="selectOne" parameterType="Map" resultMap="refundFlowMap">
    <![CDATA[
            SELECT * FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
    </trim>
    LIMIT 1
  </select>

  <select id="selectOneDTO" parameterType="Map" resultMap="refundFlowDTOMap">
    <![CDATA[
            SELECT * FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
    </trim>
    LIMIT 1
  </select>

  <select id="select" parameterType="Map" resultMap="refundFlowMap">
    <![CDATA[
            SELECT * FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
    </trim>
    <if test="scs != null and scs.size() > 0">
      ORDER BY
      <foreach collection="scs" item="sc" separator=",">
          ${sc.field} ${sc.order}
      </foreach>
    </if>
    <if test="pc != null">
      LIMIT ${pc.startIndex}, ${pc.pageSize}
    </if>
  </select>

  <select id="selectDTO" parameterType="Map" resultMap="refundFlowDTOMap">
    <![CDATA[
            SELECT * FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
    </trim>
    <if test="scs != null and scs.size() > 0">
      ORDER BY
      <foreach collection="scs" item="sc" separator=",">
          ${sc.field} ${sc.order}
      </foreach>
    </if>
    <if test="pc != null">
      LIMIT ${pc.startIndex}, ${pc.pageSize}
    </if>
  </select>

  <select id="selectMap" parameterType="Map" resultType="Map">
    SELECT
    <foreach collection="columns" item="cname" separator="," open="`" close="`">
        ${cname}
    </foreach>
    FROM u_refund_flow
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
        <if test="stripeRefundNo != null">
            `stripe_refund_no`=#{stripeRefundNo}
        </if>
    </trim>
    <if test="scs != null and scs.size() > 0">
      ORDER BY
      <foreach collection="scs" item="sc" separator=",">
          ${sc.field} ${sc.order}
      </foreach>
    </if>
    <if test="pc != null">
      LIMIT ${pc.startIndex}, ${pc.pageSize}
    </if>
  </select>

  <!--统计相关查询-->
  <select id="groupCount" parameterType="Map" resultType="Map">
    <![CDATA[
            SELECT ${group} AS `group`, COUNT(DISTINCT id) AS `count` FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
    </trim>
    GROUP BY `group`
    ORDER BY `group` ASC
  </select>

  <select id="sum" parameterType="Map" resultType="Double">
    <![CDATA[
            SELECT IFNULL(SUM(${sumfield}),0) AS `sum` FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
    </trim>
  </select>

  <select id="groupSum" parameterType="Map" resultType="Map">
    <![CDATA[
            SELECT ${group} AS `group`, IFNULL(SUM(${sumfield}),0) AS `sum` FROM u_refund_flow
        ]]>
    <trim prefix="WHERE" prefixOverrides="AND|OR">
          <if test="id != null">
            AND `id`=#{id}
          </if>
          <if test="flowId != null">
            AND `flow_id`=#{flowId}
          </if>
          <if test="gatewayId != null">
            AND `gateway_id`=#{gatewayId}
          </if>
        <if test="refundNo != null">
            AND `refund_no`=#{refundNo}
        </if>
          <if test="orgRecUserId != null">
            AND `org_rec_user_id`=#{orgRecUserId}
          </if>
          <if test="refundAmount != null">
            AND `refund_amount`=#{refundAmount}
          </if>
          <if test="ordreNo != null">
            AND `ordre_no`=#{ordreNo}
          </if>
          <if test="omiPayRefundOrderNo != null">
            AND `omi_pay_refund_order_no`=#{omiPayRefundOrderNo}
          </if>
        <if test="lpsRefundId != null">
            AND `lps_refund_id`=#{lpsRefundId}
        </if>
        <if test="requestId != null">
            AND `request_id`=#{requestId}
        </if>
        <if test="replyPwd != null">
            AND `reply_pwd`=#{replyPwd}
        </if>
          <if test="transType != null">
            AND `trans_type`=#{transType}
          </if>
          <if test="state != null">
            AND `state`=#{state}
          </if>
          <if test="currency != null">
            AND `currency`=#{currency}
          </if>
          <if test="batchId != null">
            AND `batch_id`=#{batchId}
          </if>
          <if test="returnCode != null">
            AND `return_code`=#{returnCode}
          </if>
          <if test="returnMessage != null">
            AND `return_message`=#{returnMessage}
          </if>
          <if test="customerIpaddress != null">
            AND `customer_ipaddress`=#{customerIpaddress}
          </if>
          <if test="crdstrgToken != null">
            AND `crdstrg_token`=#{crdstrgToken}
          </if>
          <if test="clearState != null">
            AND `clear_state`=#{clearState}
          </if>
          <if test="clearTime != null">
            AND `clear_time`=#{clearTime}
          </if>
          <if test="notSettlementAmount != null">
            AND `not_settlement_amount`=#{notSettlementAmount}
          </if>
          <if test="settlementState != null">
            AND `settlement_state`=#{settlementState}
          </if>
          <if test="settlementTime != null">
            AND `settlement_time`=#{settlementTime}
          </if>
          <if test="reason != null">
            AND `reason`=#{reason}
          </if>
          <if test="remark != null">
            AND `remark`=#{remark}
          </if>
          <if test="createdBy != null">
            AND `created_by`=#{createdBy}
          </if>
          <if test="start != null and end != null">
            AND `created_date` BETWEEN #{start} AND #{ end}
          </if>
          <if test="modifiedBy != null">
            AND `modified_by`=#{modifiedBy}
          </if>
          <if test="modifiedDate != null">
            AND `modified_date`=#{modifiedDate}
          </if>
        <if test="makeUpFee != null">
            AND `make_up_fee`=#{makeUpFee}
        </if>
        <if test="makeUpState != null">
            AND `make_up_state`=#{makeUpState}
        </if>
          <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
          </choose>
          <if test="ip != null">
            AND `ip`=#{ip}
          </if>
          <if test="checkState != null">
            AND `check_state`=#{checkState}
          </if>
          <if test="checkTime != null">
            AND `check_time`=#{checkTime}
          </if>
        <if test="orgThirdNo != null">
            AND `org_third_no`=#{orgThirdNo}
        </if>
    </trim>
    GROUP BY `group`
    ORDER BY `group` ASC
  </select>

    <select id="selectFlowDTO" resultType="com.uwallet.pay.main.model.dto.RefundFlowDTO">
      SELECT * FROM  u_refund_flow WHERE state IN (0, 3) AND status = 1
         <![CDATA[AND created_date > unix_timestamp(DATE_SUB(NOW(), INTERVAL 8 DAY))*1000
                AND modified_date < unix_timestamp(DATE_SUB(NOW(), INTERVAL 5 MINUTE))*1000
        ]]>
  </select>

    <update id="addQrPayClearBatchId" parameterType="Map" >
        UPDATE u_refund_flow
        <set>
            <if test="batchId != null">
                `batch_id`=#{batchId},
                settlement_state = (case when settlement_state=3 then 5 else 2 end),
            </if>
            <if test="modifiedBy != null">
                `modified_by`=#{modifiedBy},
            </if>
            <if test="modifiedDate != null">
                `modified_date`=#{modifiedDate},
            </if>
        </set>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <![CDATA[And status > 0]]>
            AND state = 2 AND settlement_state=3
            AND gateway_id=#{gatewayId}
            AND org_rec_user_id in (
            select DISTINCT (pp.rec_user_id) from (
            select p.rec_user_id from u_qr_pay_flow p left join u_withhold_flow w on p.id =w.flow_id
            <trim prefix="WHERE" prefixOverrides="AND|OR">
                <if test="gatewayId != null">
                    AND p.`gateway_id`=#{gatewayId}
                </if>
                <if test="isNeedClear != null">
                    AND p.`is_need_clear`=#{isNeedClear}
                </if>
                <if test="orgClearState != null">
                    AND p.`clear_state`=#{orgClearState}
                </if>
                <if test="start != null and end != null">
                    AND p.`created_date` BETWEEN #{start} AND #{ end}
                </if>
                <if test="orgBatchId != null">
                    AND p.`batch_id`=#{orgBatchId}
                </if>
                <if test="state != null">
                    AND p.`state`=#{state}
                </if>
                <if test="state != null">
                    AND w.`check_state` in ('1','2')
                </if>
            </trim>)pp)
        </trim>
    </update>

    <update id="countClearList" parameterType="Map" >
        SELECT COUNT(*)  FROM u_refund_flow
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <![CDATA[And status > 0]]>
            AND ((state = 1 AND settlement_state=0 ) or (state = 2 AND settlement_state=3 ))
            AND org_rec_user_id in (
            select pp.rec_user_id from (
            select distinct(p.rec_user_id) from u_qr_pay_flow p left join u_withhold_flow w on p.id =w.flow_id
            <trim prefix="WHERE" prefixOverrides="AND|OR">
                <if test="gatewayId != null">
                    AND p.`gateway_id`=#{gatewayId}
                </if>
                <if test="isNeedClear != null">
                    AND p.`is_need_clear`=#{isNeedClear}
                </if>
                <if test="orgClearState != null">
                    AND p.`clear_state`=#{orgClearState}
                </if>
                <if test="start != null and end != null">
                    AND p.`created_date` BETWEEN #{start} AND #{ end}
                </if>
                <if test="orgBatchId != null">
                    AND p.`batch_id`=#{orgBatchId}
                </if>
                <if test="state != null">
                    AND p.`state`=#{state}
                </if>
                <if test="state != null">
                    AND w.`check_state` in ('1','2')
                </if>
            </trim>)pp)
        </trim>
    </update>

    <update id="clearData" parameterType="Map" >
        update u_refund_flow
        set settlement_state = 4,not_settlement_amount= 0
        where
        org_rec_user_id = #{recUserId}
        and batch_id = #{orgBatchId}
        <choose>
            <when test="status != null">AND status = #{status}</when>
            <otherwise><![CDATA[AND status > 0]]></otherwise>
        </choose>
        AND settlement_state = 5
    </update>

    <update id="updateAmountOut" parameterType="Map" >
        update u_refund_flow
        set settlement_state =  #{settlementState},
        not_settlement_amount= not_settlement_amount -  #{toLoseAmount}
        where
        org_rec_user_id = #{recUserId}
        and id = #{id}
        <![CDATA[AND status > 0 AND not_settlement_amount -  #{toLoseAmount} >= 0 ]]>
    </update>

    <select id="selectReason" resultType="com.uwallet.pay.main.model.dto.RefundFlowDTO">
        SELECT * FROM  u_refund_flow WHERE state = 1 AND status > 0 AND flow_id = #{flowId}
    </select>

    <update id="updateRefundFlowToCheckFail" parameterType="Map" >
        update u_refund_flow a set a.state = '2',a.modified_date = #{updateTime} ,
        a.settlement_state = (case when a.settlement_state in ('1','6') then '3' else a.settlement_state end )
        where a.id = #{id};
    </update>

    <select id="getUnCleared" resultType="com.uwallet.pay.main.model.dto.RefundFlowDTO">
        SELECT sum(not_settlement_amount) as not_settlement_amount FROM  u_refund_flow  WHERE
        <![CDATA[state <> '2'
        and settlement_state in ('0','6')
        AND status > 0 ]]> AND org_rec_user_id =  #{userId}
        AND gateway_id = #{gateWayId}
    </select>

    <select id="findAllUnClearedRefundFlow" resultType="com.uwallet.pay.main.model.dto.RefundFlowDTO">
        SELECT *  FROM  u_refund_flow  WHERE
        <![CDATA[state <> '2'
        and settlement_state in ('0','6')
        AND status > 0 ]]> AND org_rec_user_id =  #{recUserId}
        AND gateway_id = #{gateWayId}
    </select>

    <select id="selectRefund" resultType="com.uwallet.pay.main.model.dto.RefundListDTO">
        SELECT * FROM (
            SELECT
                qrPay.merchant_id,
                merchant.corporate_name,
                merchant.BSB,
                merchant.account_no,
                merchant.bank_name,
                SUM(refund.refund_amount) refund_amount,
                COUNT(*) refund_count
            FROM u_refund_flow refund
            LEFT JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id
            LEFT JOIN u_merchant merchant ON qrPay.merchant_id = merchant.id
            WHERE refund.`status` = 1 AND refund.state = 1
            <if test="start != null and end != null">
                AND refund.created_date BETWEEN #{start} AND #{end}
            </if>
            GROUP BY qrPay.merchant_id
        ) refund_list
        <if test="pc != null">
            LIMIT ${pc.startIndex}, ${pc.pageSize}
        </if>
    </select>

    <select id="selectRefundCount" resultType="int">
        SELECT COUNT(DISTINCT merchant_id) FROM (
            SELECT
                qrPay.merchant_id,
                merchant.corporate_name,
                merchant.BSB,
                merchant.account_no,
                merchant.bank_name,
                SUM(refund.refund_amount) refund_amount,
                COUNT(*) refund_count
            FROM u_refund_flow refund
            LEFT JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id
            LEFT JOIN u_merchant merchant ON qrPay.merchant_id = merchant.id
            WHERE refund.`status` = 1 AND refund.state = 1
            <if test="start != null and end != null">
                AND refund.created_date BETWEEN #{start} AND #{end}
            </if>
            GROUP BY qrPay.merchant_id
        ) refund_count
    </select>

    <select id="selectRefundDetail" resultType="com.uwallet.pay.main.model.dto.RefundDetailListDTO">
        SELECT
            refund.id,
            refund.flow_id,
            payUser.phone,
            qrPay.trans_amount,
            qrPay.pay_amount,
            refund.refund_amount,
            refund.created_date
        FROM u_refund_flow refund
        LEFT JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id
        LEFT JOIN u_user payUser ON payUser.id = qrPay.pay_user_id
        WHERE 1=1
        AND refund.`status` = 1 AND refund.state = 1
        <if test="merchantId != null">
            AND qrPay.merchant_id = #{merchantId}
        </if>
        <if test="start != null and end != null">
            AND refund.created_date BETWEEN #{start} AND #{end}
        </if>
        ORDER BY refund.created_date DESC
        <if test="pc != null">
            LIMIT ${pc.startIndex}, ${pc.pageSize}
        </if>
    </select>

    <select id="selectRefundDetailCount" resultType="int">
        SELECT
            COUNT(DISTINCT refund.id)
        FROM u_refund_flow refund
        LEFT JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id
        LEFT JOIN u_user payUser ON payUser.id = qrPay.pay_user_id
        WHERE 1=1
        AND refund.`status` = 1 AND refund.state = 1
        <if test="merchantId != null">
            AND qrPay.merchant_id = #{merchantId}
        </if>
        <if test="start != null and end != null">
            AND refund.created_date BETWEEN #{start} AND #{end}
        </if>
    </select>

    <update id="updateMakeUpState">
        UPDATE u_refund_flow refund JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id set refund.make_up_state = #{state}
        WHERE refund.`status` = 1 AND refund.state = 1 AND qrPay.clear_state = 1 AND refund.check_state IN (1, 2) AND refund.make_up_state = 0
    </update>

    <select id="makeUpCSVData" resultType="com.uwallet.pay.main.model.dto.ClearBillCSVDTO">
        SELECT
	        mer.corporate_name AS ContactName,
	        mer.email AS EmailAddress,
	        mer.address AS POAddressLine1,
	        mer.city AS POCity,
	        country.en_name AS POCountry,
	        merchantState.en_name AS PORegion,
	        mer.postcode AS POPostalCode,
	        date_format(now(), '%d/%c/%Y') AS InvoiceDate,
	        date_format(now(), '%d/%c/%Y') AS DueDate,
	        1 AS Quantity,
	        make_up_data.make_up_fee AS UnitAmount,
	        'AUD' AS Currency
        FROM (
				SELECT
					qrPay.merchant_id,
					SUM(refund.make_up_fee) make_up_fee
				FROM u_refund_flow refund
				LEFT JOIN u_qr_pay_flow qrPay ON refund.flow_id = qrPay.id
				WHERE refund.make_up_state = 2
				GROUP BY qrPay.merchant_id
		) make_up_data
		LEFT JOIN u_merchant mer ON mer.id = make_up_data.merchant_id
		LEFT JOIN u_static_data merchantState ON mer.merchant_state = merchantState.value AND merchantState.code = 'merchantState'
		LEFT JOIN u_static_data country ON mer.county = country.value AND country.code = 'county'
    </select>

    <update id="updateClearBatch"  parameterType="Map">
        update u_refund_flow set not_settlement_amount = refund_amount ,settlement_state=   #{settlementState},
        settlement_time =  #{settlementTime},modified_date= #{modifiedDate}
where   status = 1 and state = 2 and batch_id =  #{batchId}
    </update>

</mapper>
